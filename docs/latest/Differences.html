<!DOCTYPE html> 
<html lang="en-US" xml:lang="en-US" > 
<head><title>Differences</title> 
<meta  charset="utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="viewport" content="width=device-width,initial-scale=1" /> 
<link rel="stylesheet" type="text/css" href="Differences.css" /> 
<meta name="src" content="Differences.tex" /> 
<link rel="stylesheet" type="text/css" href="../main.css" /></head><body 
><div class="center" 
>
<!--l. 139--><p class="noindent" >
</p><!--l. 146--><p class="noindent" > <img 
src="Logos/Logo-.png" alt="PIC"  
width="160" height="160"  />
</p><!--l. 150--><p class="noindent" >OpenCore
</p><!--l. 154--><p class="noindent" >Reference Manual (0.6<span class="sout">.0</span><span class="uwave">.1</span>)
</p><!--l. 158--><p class="noindent" >[2020.08.15]
</p><!--l. 166--><p class="noindent" >Copyright ©2018-2020 vit9696
</p>
</div>
                                                                                                  
                                                                                                  
<h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
<div class="tableofcontents">
<span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-3">Introduction</a></span>
<br /> <span class="subsectionToc" >1.1 <a 
href="#x1-30001" id="QQ2-1-4">Generic Terms</a></span>
<br /> <span class="subsectionToc" >3.5 <a 
href="#x1-130005" id="QQ2-1-16">Debugging</a></span>
<br /> <span class="subsectionToc" >8.2 <a 
href="#x1-400002" id="QQ2-1-43">Properties</a></span>
<br /> <span class="subsectionToc" >8.3 <a 
href="#x1-410003" id="QQ2-1-44">Boot Properties</a></span>
<br /> <span class="subsectionToc" >8.4 <a 
href="#x1-420004" id="QQ2-1-45">Debug Properties</a></span>
<br /> <span class="subsectionToc" >8.5 <a 
href="#x1-430005" id="QQ2-1-46">Security Properties</a></span>
<br /> <span class="subsectionToc" >8.6 <a 
href="#x1-440006" id="QQ2-1-47">Entry Properties</a></span>
<br /> <span class="subsectionToc" >9.3 <a 
href="#x1-480003" id="QQ2-1-51">Mandatory Variables</a></span>
<br /> <span class="subsectionToc" >9.4 <a 
href="#x1-490004" id="QQ2-1-52">Recommended Variables</a></span>
<br /><span class="sectionToc" >10 <a 
href="#x1-5100010" id="QQ2-1-54">PlatformInfo</a></span>
<br /> <span class="subsectionToc" >10.1 <a 
href="#x1-520001" id="QQ2-1-55">Properties</a></span>
<br /> <span class="subsectionToc" >11.3 <a 
href="#x1-600003" id="QQ2-1-63">Tools and Applications</a></span>
<br /> <span class="subsectionToc" >11.5 <a 
href="#x1-620005" id="QQ2-1-66">OpenRuntime</a></span>
</div>
<a 
 id="x1-1001r1"></a>
<h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>Introduction</h3>
<!--l. 175--><p class="noindent" >This document provides information on <a 
href="https://github.com/acidanthera/OpenCorePkg" >OpenCore</a> user configuration file format used to setup the correct functioning
of macOS operating system. It is to be read as the official clarification of expected OpenCore behaviour. All
deviations, if found in published OpenCore releases, shall be considered documentation or implementation bugs,
and are requested to be reported through <a 
href="https://github.com/acidanthera/bugtracker" >Acidanthera Bugtracker</a>. Errata sheet is available in <a 
href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Errata/Errata.pdf" >OpenCorePkg
repository</a>.
</p><!--l. 185--><p class="noindent" >This document is structured as a specification, and is not meant to provide a step by step algorithm for configuring end-user
board support package (BSP). The intended audience of the document are programmers and engineers with
basic understanding of macOS internals and UEFI functioning. For these reasons this document is available
exclusively in English, and all other sources or translations of this document are unofficial and may contain
errors.
</p><!--l. 192--><p class="noindent" >Third-party articles, utilities, books, and alike may be more useful for a wider audience as they could provide guide-like
material. However, they are prone to their authors’ preferences, tastes, this document misinterpretation, and essential
obsolescence. In case you use these sources, for example, <a 
href="https://dortania.github.io" >Dortania</a>’s <a 
href="https://dortania.github.io/OpenCore-Install-Guide" >OpenCore Install Guide</a> and <a 
href="https://dortania.github.io/getting-started" >related material</a>, please ensure
to follow this document for every made decision and judge its consequences.
</p><!--l. 200--><p class="noindent" >Be warned that regardless of the sources used you are required to fully understand every dedicated OpenCore configuration
option and concept prior to reporting any issues in <a 
href="https://github.com/acidanthera/bugtracker" >Acidanthera Bugtracker</a>.
<a 
 id="x1-2001r1"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001"></a>Generic Terms</h4>
     <ul class="itemize1">
     <li class="itemize">plist —  Subset  of  ASCII  Property  List  format  written  in  XML,  also  know  as  XML  plist  format  version
     1.  Uniform  Type  Identifier  (UTI):  com.apple.property-list.  Plists  consist  of  plist objects,  which  are
     combined to form a hierarchical structure. Due to plist format not being well-defined, all the definitions of this
     document may only be applied after plist is considered valid by running plutil -lint. External references:
     https://www.apple.com/DTDs/PropertyList-1.0.dtd, man plutil.
                                                                                                  
                                                                                                  
     <li class="itemize">sizeof operator should take variables instead of types where possible to be error prone. Use ARRAY_SIZE to
     obtain array size in elements. Use L_STR_LEN and L_STR_SIZE macros from OcStringLib to obtain string literal
     sizes to ensure compiler optimisation.
     </li>
     <li class="itemize">Do not use goto keyword. Prefer early return, break, or continue after failing to pass error checking instead
     of nesting conditionals.
     </li>
     <li class="itemize">Use EFIAPI, force UEFI calling convention, only in protocols, external callbacks between modules, and functions
     with variadic arguments.
     </li>
     <li class="itemize">Provide inline documentation to every added function, at least describing its inputs, outputs, precondition,
     postcondition, and giving a brief description.
     </li>
     <li class="itemize">Do not use RETURN_STATUS. Assume EFI_STATUS to be a matching superset that is to be always used when
     BOOLEAN is not enough.
     </li>
     <li class="itemize">Security violations should halt the system or cause a forced reboot.</li></ul>
<!--l. 790--><p class="noindent" >Codestyle. The codebase follows <a 
href="https://github.com/tianocore/tianocore.github.io/wiki/Code-Style-C" >EDK II codestyle</a> with few changes and clarifications. </p>
     <ul class="itemize1">
     <li class="itemize">Write inline documentation for the functions and variables only once: in headers, where a header prototype is
     available, and inline for static variables and functions.
     </li>
     <li class="itemize">Use line length of 120 characters or less, preferably 100 characters.
     </li>
     <li class="itemize">Use spaces after casts, e.g. (VOID *)(UINTN) Variable.
     </li>
     <li class="itemize">Use SPDX license headers as shown in <a 
href="https://github.com/acidanthera/bugtracker/issues/483" >acidanthera/bugtracker#483</a>.</li></ul>
<a 
 id="x1-12001r15"></a>
<h4 class="subsectionHead"><span class="titlemark">3.5   </span> <a 
 id="x1-130005"></a>Debugging</h4>
<!--l. 805--><p class="noindent" >The codebase incorporates EDK II debugging and few custom features to improve the experience. </p>
     <ul class="itemize1">
     <li class="itemize">Use module prefixes, 2-5 letters followed by a colon (:), for debug messages. For OpenCorePkg use OC:, for
     libraries and drivers use their own unique prefixes.
     </li>
     <li class="itemize">Do not use dots (.) in the end of debug messages and separate EFI_STATUS, printed by %r, with a hyphen (e.g.
     OCRAM: Allocation of %u bytes failed - %r\n).
     </li>
     <li class="itemize">Use DEBUG_CODE_BEGIN () and DEBUG_CODE_END () constructions to guard debug checks that may potentially
     reduce the performance of release builds and are otherwise unnecessary.
     </li>
     <li class="itemize">Use DEBUG macro to print debug messages during normal functioning, and RUNTIME_DEBUG for debugging after
     EXIT_BOOT_SERVICES.
     </li>
     <li class="itemize">Use DEBUG_VERBOSE debug level to leave debug messages for future debugging of the code, which are currently
     not necessary. By default DEBUG_VERBOSE messages are ignored even in DEBUG builds.
     </li>
     <li class="itemize">Use DEBUG_INFO debug level for all non critical messages (including errors) and DEBUG_BULK_INFO for extensive
     messages that should not appear in NVRAM log that is heavily limited in size. These messages are ignored in
     RELEASE builds.
     </li>
     <li class="itemize">Use DEBUG_ERROR to print critical human visible messages that may potentially halt the boot process, and
     DEBUG_WARN for all other human visible errors, RELEASE builds included.</li></ul>
<!--l. 825--><p class="noindent" >When trying to find the problematic change it is useful to rely on <a 
href="https://git-scm.com/docs/git-bisect" >git-bisect</a> functionality. <span class="uwave">There also are some unnoficial
resources that provide per-commit binary builds of OpenCore, like </span><a 
href="https://dortania.github.io/builds" >Dortania</a><span class="uwave">. </span>
                                                                                                  
                                                                                                  
         </p><ol  class="enumerate2" >
         <li 
  class="enumerate" id="x1-37004x1">Download <a 
href="https://github.com/LongSoft/UEFITool/releases" >UEFITool</a> and <a 
href="https://github.com/LongSoft/Universal-IFR-Extractor/releases" >IFR-Extractor</a>.
         </li>
         <li 
  class="enumerate" id="x1-37006x2">Open your firmware image in UEFITool and find CFG Lock unicode string. If it is not present, your firmware
         may not have this option and you should stop.
         </li>
         <li 
  class="enumerate" id="x1-37008x3">Extract the Setup.bin PE32 Image Section (the one UEFITool found) through Extract Body menu option.
         </li>
         <li 
  class="enumerate" id="x1-37010x4">Run IFR-Extractor on the extracted file (e.g. ./ifrextract Setup.bin Setup.txt).
         </li>
         <li 
  class="enumerate" id="x1-37012x5">Find CFG Lock, VarStoreInfo (VarOffset/VarName): in Setup.txt and remember the offset right after
         it (e.g. 0x123).
         </li>
         <li 
  class="enumerate" id="x1-37014x6">Download and run <a 
href="http://brains.by/posts/bootx64.7z" >Modified GRUB Shell</a> compiled by <a 
href="https://geektimes.com/post/258090" >brainsucker</a> or use <a 
href="https://github.com/datasone/grub-mod-setup_var" >a newer version</a> by <a 
href="https://github.com/datasone" >datasone</a>.
         </li>
         <li 
  class="enumerate" id="x1-37016x7">Enter setup_var 0x123 0x00 command, where 0x123 should be replaced by your actual offset, and reboot.</li></ol>
     <!--l. 2141--><p class="noindent" ><span class="sout">WARNING</span><span class="uwave">Warning</span>: Variable offsets are unique not only to each motherboard but even to its firmware version. Never
     ever try to use an offset without checking.
     </p></li>
     <li 
  class="enumerate" id="x1-37018x2">AppleXcpmCfgLock<br 
class="newline" />Type: plist boolean<br 
class="newline" />Failsafe: false<br 
class="newline" />Description: Disables PKG_CST_CONFIG_CONTROL (0xE2) MSR modification in XNU kernel, commonly causing early
     kernel panic, when it is locked from writing (XCPM power management).
     <!--l. 2152--><p class="noindent" >Note: This option should be avoided whenever possible. See AppleCpuPmCfgLock description for more
     details.
     </p></li>
     <li 
  class="enumerate" id="x1-37020x3">AppleXcpmExtraMsrs<br 
class="newline" />Type: plist boolean<br 
class="newline" />Failsafe: false<br 
class="newline" />Description: Disables multiple MSR access critical for select CPUs, which have no native XCPM support.
     <!--l. 2162--><p class="noindent" >This is normally used in conjunction with Emulate section on Haswell-E, Broadwell-E, Skylake-SP, and similar CPUs.
     More details on the XCPM patches are outlined in <a 
href="https://github.com/acidanthera/bugtracker/issues/365" >acidanthera/bugtracker#365</a>.
     </p><!--l. 2166--><p class="noindent" >Note: Additional not provided patches will be required for Ivy Bridge or Pentium CPUs. It is recommended to use
     AppleIntelCpuPowerManagement.kext for the former.
     </p></li>
     <li 
  class="enumerate" id="x1-37022x4">AppleXcpmForceBoost<br 
class="newline" />Type: plist boolean<br 
class="newline" />Failsafe: false<br 
class="newline" />Description: Forces maximum performance in XCPM mode.
     <!--l. 2175--><p class="noindent" >This patch writes 0xFF00 to MSR_IA32_PERF_CONTROL (0x199), effectively setting maximum multiplier for all the
     time.
     </p><!--l. 2178--><p class="noindent" >Note: While this may increase the performance, this patch is strongly discouraged on all systems but those
     explicitly dedicated to scientific or media calculations. In general only certain Xeon models benefit from the
     patch.
     </p></li>
     <li 
  class="enumerate" id="x1-37024x5">CustomSMBIOSGuid<br 
class="newline" />Type: plist boolean<br 
class="newline" />Failsafe: false<br 
class="newline" />Description: Performs GUID patching for UpdateSMBIOSMode Custom mode. Usually relevant for Dell
     laptops.
     </li>
                                                                                                  
                                                                                                  
     <ul class="itemize1">
     <li class="itemize">Try looking up first valid primary option through BootNext UEFI variable.
     </li>
     <li class="itemize">On failure looking up first valid primary option through BootOrder UEFI variable.
     </li>
     <li class="itemize">Mark the option as the default option to boot.
     </li>
     <li class="itemize">Boot option through the picker or without it depending on the ShowPicker option.
     </li>
     <li class="itemize">Show picker on failure otherwise.</li></ul>
<!--l. 2385--><p class="noindent" >Note 1: This process is meant to work reliably only when RequestBootVarRouting option is enabled or the firmware does not
control UEFI boot options (OpenDuetPkg or custom BDS). Without BootProtect it also is possible that other operating
systems overwrite OpenCore, make sure to enable it if you plan to use them.
</p><!--l. 2390--><p class="noindent" >Note 2: UEFI variable boot options’ boot arguments will be removed if present as they may contain arguments compromising
the operating system, which is undesired once secure boot is enabled.
</p><!--l. 2394--><p class="noindent" >Note 3: Some operating systems, namely Windows, will create their boot option and mark it as top most upon
first boot or after NVRAM Reset. When this happens default boot entry choice will update till next manual
reconfiguration.
<a 
 id="x1-39013r42"></a>
</p>
<h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-400002"></a>Properties</h4>
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-40002x1">Boot<br 
class="newline" />Type: plist dict<br 
class="newline" />Description: Apply boot configuration described in <a 
href="#x1-410003">Boot Properties</a> section below.
     </li>
     <li 
  class="enumerate" id="x1-40004x2">BlessOverride<br 
class="newline" />Type: plist array<br 
class="newline" />Description: Add custom scanning paths through bless model.
     <!--l. 2412--><p class="noindent" >Designed to be filled with plist string entries containing absolute UEFI paths to customised bootloaders,
     for  example,  \EFI\debian\grubx64.efi for  Debian  bootloader.  This  allows  unusual  boot  paths  to  be
     automaticlly discovered by the boot picker. Designwise they are equivalent to predefined blessed path, such
     as \System\Library\CoreServices\boot.efi or \EFI\Microsoft\Boot\bootmgfw.efi, but unlike predefined
     bless paths they have highest priority.
     </p></li>
     <li 
  class="enumerate" id="x1-40006x3">Debug<br 
class="newline" />Type: plist dict<br 
class="newline" />Description: Apply debug configuration described in <a 
href="#x1-420004">Debug Properties</a> section below.
     </li>
     <li 
  class="enumerate" id="x1-40008x4">Entries<br 
class="newline" />Type: plist array<br 
class="newline" />Description: Add boot entries to boot picker.
     <!--l. 2432--><p class="noindent" >Designed to be filled with plist dict values, describing each load entry. See <a 
href="#x1-440006">Entry Properties</a> section below.
     </p></li>
     <li 
  class="enumerate" id="x1-40010x5">Security<br 
class="newline" />Type: plist dict<br 
class="newline" />Description: Apply security configuration described in <a 
href="#x1-430005">Security Properties</a> section below.
     </li>
     <li 
  class="enumerate" id="x1-40012x6">Tools<a 
 id="x1-400116"></a><br 
class="newline" />Type: plist array<br 
class="newline" />Description: Add tool entries to boot picker.
                                                                                                  
                                                                                                  
     <!--l. 2446--><p class="noindent" >Designed to be filled with plist dict values, describing each load entry. See <a 
href="#x1-440006">Entry Properties</a> section below.
     </p><!--l. 2449--><p class="noindent" >Note:  Select  tools,  for  example,  UEFI  Shell,  are  very  dangerous  and  MUST  NOT appear  in  production
     configurations, especially in vaulted ones and protected with secure boot, as they may be used to easily bypass
     secure boot chain. <span class="uwave">For tool examples check the </span><a 
href="#x1-600003">UEFI</a> <span class="uwave">section of this document. </span>
</p>
     </li></ol>
<a 
 id="x1-40013r43"></a>
<h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-410003"></a>Boot Properties</h4>
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-41002x1">ConsoleAttributes<br 
class="newline" />Type: plist integer<br 
class="newline" />Failsafe: 0<br 
class="newline" />Description: Sets specific attributes for console.
     <!--l. 2468--><p class="noindent" >Text renderer supports colour arguments as a sum of foreground and background colours according to UEFI
     specification. The value of black background and black foreground (0) is reserved. List of colour names:
</p>
         <ul class="itemize1">
         <li class="itemize">0x00 — EFI_BLACK
         </li>
         <li class="itemize">0x01 — EFI_BLUE
         </li>
         <li class="itemize">0x02 — EFI_GREEN
         </li>
         <li class="itemize">0x03 — EFI_CYAN
         </li>
         <li class="itemize">0x04 — EFI_RED
         </li>
         <li class="itemize">0x05 — EFI_MAGENTA
         </li>
         <li class="itemize">0x06 — EFI_BROWN
         </li>
         <li class="itemize">0x07 — EFI_LIGHTGRAY
         </li>
         <li class="itemize">0x08 — EFI_DARKGRAY
         </li>
         <li class="itemize">0x09 — EFI_LIGHTBLUE
         </li>
         <li class="itemize">0x0A — EFI_LIGHTGREEN
         </li>
         <li class="itemize">0x0B — EFI_LIGHTCYAN
         </li>
         <li class="itemize">0x0C — EFI_LIGHTRED
         </li>
         <li class="itemize">0x0D — EFI_LIGHTMAGENTA
         </li>
         <li class="itemize">0x0E — EFI_YELLOW
         </li>
         <li class="itemize">0x0F — EFI_WHITE
         </li>
         <li class="itemize">0x00 — EFI_BACKGROUND_BLACK
         </li>
         <li class="itemize">0x10 — EFI_BACKGROUND_BLUE
         </li>
         <li class="itemize">0x20 — EFI_BACKGROUND_GREEN
                                                                                                  
                                                                                                  
     following actions are considered:
</p>
         <ul class="itemize1">
         <li class="itemize">Default — this is the default option, and it lets OpenCore built-in boot picker to loads the default boot
         option as specified in <a 
href="https://support.apple.com/HT202796" >Startup Disk</a> preference pane.
         </li>
         <li class="itemize">ShowPicker — this option forces picker to show. Normally it can be achieved by holding OPT key during
         boot. Setting ShowPicker to true will make ShowPicker the default option.
         </li>
         <li class="itemize">ResetNvram —  this  option  performs  select  UEFI  variable  erase  and  is  normally  achieved  by  holding
         CMD+OPT+P+R key combination during boot. Another way to erase UEFI variables is to choose Reset NVRAM
         in the picker. This option requires AllowNvramReset to be set to true.
         </li>
         <li class="itemize">BootApple — this options performs booting to the first found Apple operating system unless the default
         chosen operating system is already made by Apple. Hold X key to choose this option.
         </li>
         <li class="itemize">BootAppleRecovery — this option performs booting to Apple operating system recovery. Either the one
         related to the default chosen operating system, or first found in case default chosen operating system is not
         made by Apple or has no recovery. Hold CMD+R key combination to choose this option.</li></ul>
     <!--l. 2716--><p class="noindent" >Note 1: Activated KeySupport, OpenUsbKbDxe, or similar driver is required for key handling to work. On many firmwares
     it is not possible to get all the keys function.
     </p><!--l. 2719--><p class="noindent" >Note 2: In addition to OPT OpenCore supports Escape key to display picker when ShowPicker is disabled. This key exists
     for Apple picker mode and for firmwares with PS/2 keyboards that fail to report held OPT key and require continual
     presses of Escape key to enter the boot menu.
     </p><!--l. 2724--><p class="noindent" >Note 3: On Macs with problematic GOP it may be difficult to access Apple BootPicker. <span class="sout">To </span><span class="uwave">BootKicker</span> <span class="uwave">utility can be
     blessed to </span>workaround this problem even without loading OpenCore<span class="uwave">. On some Macs </span>BootKicker <span class="sout">utility can be
     blessed</span><span class="uwave">will not run from OpenCore</span>.
</p>
     </li></ol>
<a 
 id="x1-41021r44"></a>
<h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-420004"></a>Debug Properties</h4>
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-42002x1">AppleDebug<br 
class="newline" />Type: plist boolean<br 
class="newline" />Failsafe: false<br 
class="newline" />Description: Enable boot.efi debug log saving to OpenCore log.
     <!--l. 2740--><p class="noindent" >Note: This option only applies to 10.15.4 and newer.
     </p></li>
     <li 
  class="enumerate" id="x1-42004x2">ApplePanic<br 
class="newline" />Type: plist boolean<br 
class="newline" />Failsafe: false<br 
class="newline" />Description: Save macOS kernel panic to OpenCore root partition.
     <!--l. 2748--><p class="noindent" >The file is saved as panic-YYYY-MM-DD-HHMMSS.txt. It is strongly recommended to have keepsyms=1 boot
     argument to see debug symbols in the panic log. In case it was not present kpdescribe.sh utility (bundled with
     OpenCore) may be used to partially recover the stacktrace.
     </p><!--l. 2753--><p class="noindent" >Development  and  debug  kernels  produce  more  helpful  kernel  panics.  Consider  downloading  and  installing
     KernelDebugKit from <a 
href="https://developer.apple.com" >developer.apple.com</a> when debugging a problem. To activate a development kernel you
     will need to add a kcsuffix=development boot argument. Use uname -a command to ensure that your current
     loaded kernel is a development (or a debug) kernel.
     </p><!--l. 2760--><p class="noindent" >In case OpenCore kernel panic saving mechanism was not used, kernel panics may still be found in <br 
class="newline" />/Library/Logs/DiagnosticReports directory. Starting with macOS Catalina kernel panics are stored in JSON
                                                                                                  
                                                                                                  
     
     
     
     
                          
      
     
     
      
     
     
      
     
     
      
     
     
      
     
     
      
     
     
      
     
                                               
      
     
     
      
     
                                     
      
     
     
      
     
     
      
     
     
      
     
     
      
     
     
      
     
      
      
        
      
     
        
      
     
     
      
        
      
     
     
      
     
     
      
     
     
      
     
                                  
      
     
     
      
     
             </body>
</html>